<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.spring_boot_mode.model.dao.DatabaseBackupDao">

    <!-- 获取所有表名 -->
    <select id="getAllTables" resultType="java.lang.String">
        SELECT table_name 
        FROM information_schema.tables 
        WHERE table_schema = #{databaseName}
        AND table_type = 'BASE TABLE'
        ORDER BY table_name
    </select>

    <!-- 获取表的创建语句 -->
    <select id="getTableCreateSql" resultType="java.lang.String">
        SHOW CREATE TABLE ${tableName}
    </select>

    <!-- 获取表的所有数据 (返回列名) -->
    <select id="getTableData" resultType="java.lang.String">
        SELECT * FROM ${tableName}
    </select>

    <!-- 保存备份记录 -->
    <insert id="insertBackupRecord" parameterType="com.example.spring_boot_mode.model.entity.DatabaseBackup">
        INSERT INTO db_backup_record (file_name, file_path, file_size, create_time, status, remark)
        VALUES (#{fileName}, #{filePath}, #{fileSize}, #{createTime}, #{status}, #{remark})
    </insert>

    <!-- 查询备份记录列表 -->
    <select id="selectBackupList" resultType="com.example.spring_boot_mode.model.entity.DatabaseBackup">
        SELECT id, file_name, file_path, file_size, create_time, status, remark
        FROM db_backup_record
        ORDER BY create_time DESC
    </select>

</mapper>
